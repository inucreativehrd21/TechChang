{% extends 'base.html' %}

{% block title %}관리자 대시보드 - 테크창{% endblock %}

{% block content %}
<div class="container my-4" style="color:#e5e7eb;">
  <!-- 페이지 헤더 -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>
      <i class="fas fa-tachometer-alt me-2 text-primary"></i>관리자 대시보드
    </h2>
    <div>
      <a href="{% url 'common:admin_blocked_ip_list' %}" class="btn btn-danger me-2">
        <i class="fas fa-ban me-2"></i>IP 차단 관리
      </a>
      <a href="{% url 'common:admin_user_list' %}" class="btn btn-primary">
        <i class="fas fa-users me-2"></i>사용자 관리
      </a>
    </div>
  </div>

  <!-- 통계 카드 -->
  <div class="row g-3 mb-4">
    <!-- 전체 사용자 -->
    <div class="col-md-3">
      <div class="card border-0 premium-glass-card" style="background: linear-gradient(135deg, rgba(14,165,233,0.1) 0%, rgba(6,182,212,0.1) 100%); border:1px solid rgba(14,165,233,0.2); backdrop-filter: blur(10px);">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="mb-1" style="color:#7dd3fc; font-weight: 600;">전체 사용자</h6>
              <h3 class="mb-0 text-light" style="font-weight: 800;">{{ total_users }}</h3>
            </div>
            <div class="rounded-circle p-3" style="background:rgba(14,165,233,0.2); box-shadow: 0 4px 12px rgba(14,165,233,0.3);">
              <i class="fas fa-users fa-2x" style="color:#0ea5e9;"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 활성 사용자 -->
    <div class="col-md-3">
      <div class="card border-0 premium-glass-card" style="background: linear-gradient(135deg, rgba(34,197,94,0.1) 0%, rgba(16,185,129,0.1) 100%); border:1px solid rgba(34,197,94,0.2); backdrop-filter: blur(10px);">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="mb-1" style="color:#86efac; font-weight: 600;">활성 사용자</h6>
              <h3 class="mb-0" style="color:#22c55e; font-weight: 800;">{{ active_users }}</h3>
            </div>
            <div class="rounded-circle p-3" style="background:rgba(34,197,94,0.2); box-shadow: 0 4px 12px rgba(34,197,94,0.3);">
              <i class="fas fa-user-check fa-2x" style="color:#22c55e;"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 이메일 인증 사용자 -->
    <div class="col-md-3">
      <div class="card border-0 premium-glass-card" style="background: linear-gradient(135deg, rgba(168,85,247,0.1) 0%, rgba(139,92,246,0.1) 100%); border:1px solid rgba(168,85,247,0.2); backdrop-filter: blur(10px);">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="mb-1" style="color:#c4b5fd; font-weight: 600;">이메일 인증</h6>
              <h3 class="mb-0" style="color:#a78bfa; font-weight: 800;">{{ email_verified_users }}</h3>
            </div>
            <div class="rounded-circle p-3" style="background:rgba(168,85,247,0.2); box-shadow: 0 4px 12px rgba(168,85,247,0.3);">
              <i class="fas fa-envelope-circle-check fa-2x" style="color:#a855f7;"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 비활성 사용자 -->
    <div class="col-md-3">
      <div class="card border-0 premium-glass-card" style="background: linear-gradient(135deg, rgba(248,113,113,0.1) 0%, rgba(239,68,68,0.1) 100%); border:1px solid rgba(248,113,113,0.2); backdrop-filter: blur(10px);">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="mb-1" style="color:#fca5a5; font-weight: 600;">비활성 사용자</h6>
              <h3 class="mb-0" style="color:#f87171; font-weight: 800;">{{ inactive_users }}</h3>
            </div>
            <div class="rounded-circle p-3" style="background:rgba(248,113,113,0.2); box-shadow: 0 4px 12px rgba(248,113,113,0.3);">
              <i class="fas fa-user-times fa-2x" style="color:#f87171;"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 회원 등급별 통계 -->
  <div class="card mb-4 premium-glass-card" style="background: linear-gradient(135deg, rgba(102,126,234,0.05) 0%, rgba(118,75,162,0.05) 100%); border:1px solid rgba(102,126,234,0.15); backdrop-filter: blur(10px); color:#e5e7eb;">
    <div class="card-header" style="background: linear-gradient(135deg, rgba(102,126,234,0.1) 0%, rgba(118,75,162,0.1) 100%); border-bottom: 2px solid rgba(102,126,234,0.2);">
      <h5 class="mb-0" style="font-weight: 700; color: #e5e7eb;">
        <i class="fas fa-chart-pie me-2" style="color: #a78bfa;"></i>회원 등급별 통계
      </h5>
    </div>
    <div class="card-body">
      <div class="row">
        {% for stat in rank_stats %}
          <div class="col-md-4 mb-3">
            <div class="text-center p-4 rounded" style="background: linear-gradient(135deg, rgba(255,255,255,0.06) 0%, rgba(255,255,255,0.02) 100%); border:1px solid rgba(255,255,255,0.12); color:#e5e7eb; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
              {% if stat.rank == 'regular' %}
                <div class="badge mb-2" style="font-size: 1rem; background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); padding: 0.5rem 1rem;">일반회원</div>
              {% elif stat.rank == 'member' %}
                <div class="badge mb-2" style="font-size: 1rem; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); padding: 0.5rem 1rem;">정회원</div>
              {% elif stat.rank == 'tech_chang' %}
                <div class="badge mb-2" style="font-size: 1rem; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); padding: 0.5rem 1rem;">테크창</div>
              {% endif %}
              <h3 class="mb-0" style="font-weight: 800; color: #f3f4f6;">{{ stat.count }}명</h3>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- 최근 가입 사용자 -->
  <div class="card premium-glass-card" style="background: linear-gradient(135deg, rgba(14,165,233,0.05) 0%, rgba(6,182,212,0.05) 100%); border:1px solid rgba(14,165,233,0.15); backdrop-filter: blur(10px); color:#e5e7eb;">
    <div class="card-header" style="background: linear-gradient(135deg, rgba(14,165,233,0.1) 0%, rgba(6,182,212,0.1) 100%); border-bottom: 2px solid rgba(14,165,233,0.2);">
      <h5 class="mb-0" style="font-weight: 700; color: #e5e7eb;">
        <i class="fas fa-user-plus me-2" style="color: #7dd3fc;"></i>최근 가입 사용자
      </h5>
    </div>
    <div class="card-body">
      <style>
        .admin-dark-table > :not(caption) > * > * {
          background-color: transparent !important;
          color: #e5e7eb !important;
          border-color: rgba(255,255,255,0.08) !important;
        }
        .admin-dark-table thead {
          background: rgba(255,255,255,0.08);
        }
        .admin-dark-table tbody tr:nth-child(even) {
          background-color: rgba(255,255,255,0.02) !important;
        }
      </style>
      <div class="table-responsive">
        <table class="table table-hover mb-0 admin-dark-table" style="color:#e5e7eb; background:#0f172a;">
          <thead>
            <tr>
              <th>사용자명</th>
              <th>닉네임</th>
              <th>이메일</th>
              <th>이메일 인증</th>
              <th>등급</th>
              <th>가입일</th>
              <th>상태</th>
              <th>관리</th>
            </tr>
          </thead>
          <tbody>
            {% for user in recent_users %}
              <tr>
                <td>{{ user.username }}</td>
                <td>{{ user.profile.nickname|default:"-" }}</td>
                <td>{{ user.email|default:"-" }}</td>
                <td>
                  {% if user.profile.is_email_verified %}
                    <span class="badge bg-success">
                      <i class="fas fa-check-circle me-1"></i>인증완료
                    </span>
                  {% else %}
                    <span class="badge bg-warning text-dark">
                      <i class="fas fa-exclamation-triangle me-1"></i>미인증
                    </span>
                  {% endif %}
                </td>
                <td>
                  <span class="badge {{ user.profile.rank_badge_class }}">
                    {{ user.profile.rank_display }}
                  </span>
                </td>
                <td>{{ user.date_joined|date:"Y-m-d H:i" }}</td>
                <td>
                  {% if user.is_active %}
                    <span class="badge bg-success">활성</span>
                  {% else %}
                    <span class="badge bg-danger">비활성</span>
                  {% endif %}
                </td>
                <td>
                  <a href="{% url 'common:admin_user_detail' user.id %}" class="btn btn-sm btn-outline-primary">
                    상세보기
                  </a>
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="8" class="text-center" style="color:#94a3b8;">등록된 사용자가 없습니다.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
