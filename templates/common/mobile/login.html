{% extends 'base_mobile.html' %}

{% block title %}로그인 - 테크창{% endblock %}

{% block extra_css %}
<style>
.m-login-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 32px 24px 24px;
    text-align: center;
    color: #fff;
}
.m-login-logo { font-size: 2rem; margin-bottom: 8px; }
.m-login-title { font-size: 1.25rem; font-weight: 800; margin-bottom: 4px; }
.m-login-sub { font-size: 0.875rem; opacity: 0.9; }
.m-login-body { padding: 24px 20px; }
.m-form-group { margin-bottom: 18px; }
.m-form-label {
    display: block;
    font-size: 0.8125rem;
    font-weight: 600;
    color: var(--text-secondary, #6b7280);
    margin-bottom: 6px;
}
.m-form-input {
    width: 100%;
    padding: 14px 16px;
    border: 1.5px solid var(--border-light, #e5e7eb);
    border-radius: 12px;
    font-size: 1rem;
    color: var(--text-primary, #111);
    background: var(--bg-primary, #fff);
    outline: none;
    transition: border-color .2s;
}
.m-form-input:focus { border-color: #667eea; }
.m-btn-primary {
    width: 100%;
    padding: 15px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #fff;
    border: none;
    border-radius: 12px;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    margin-top: 8px;
}
.m-btn-kakao {
    width: 100%;
    padding: 15px;
    background: #FEE500;
    color: #000;
    border: none;
    border-radius: 12px;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    text-decoration: none;
}
.m-divider {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 20px 0;
    color: var(--text-tertiary, #9ca3af);
    font-size: 0.8125rem;
}
.m-divider::before, .m-divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border-light, #e5e7eb);
}
.m-link-row {
    text-align: center;
    margin-top: 20px;
    font-size: 0.875rem;
    color: var(--text-secondary, #6b7280);
}
.m-link-row a { color: var(--accent-primary, #3b82f6); font-weight: 600; }
.m-accordion-header {
    width: 100%;
    padding: 14px 16px;
    background: var(--bg-secondary, #f9fafb);
    border: 1.5px solid var(--border-light, #e5e7eb);
    border-radius: 12px;
    font-size: 0.9375rem;
    font-weight: 600;
    color: var(--text-primary, #111);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    text-align: left;
}
.m-accordion-body {
    display: none;
    padding: 16px 0 0;
}
.m-accordion-body.open { display: block; }
</style>
{% endblock %}

{% block content %}
<div class="m-login-header">
    <div class="m-login-logo"><i class="fas fa-sign-in-alt"></i></div>
    <div class="m-login-title">로그인</div>
    <div class="m-login-sub">테크창 커뮤니티에 오신 것을 환영합니다</div>
</div>

<div class="m-login-body">
    <!-- 카카오 로그인 (메인) -->
    <a href="{% url 'common:kakao_login' %}" class="m-btn-kakao">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="#000000">
            <path d="M12 3c5.799 0 10.5 3.664 10.5 8.185 0 4.52-4.701 8.184-10.5 8.184a13.5 13.5 0 0 1-1.727-.11l-4.408 2.883c-.501.265-.678.236-.472-.413l.892-3.678c-2.88-1.46-4.785-3.99-4.785-6.866C1.5 6.665 6.201 3 12 3Z"/>
        </svg>
        카카오 로그인
    </a>

    <div class="m-divider">일반/관리자 로그인</div>

    <!-- ID/PW 로그인 (접기/펼치기) -->
    <button class="m-accordion-header" id="adminToggle" type="button">
        <span><i class="fas fa-user-shield me-2"></i>ID / 비밀번호 로그인</span>
        <i class="fas fa-chevron-down" id="adminChevron"></i>
    </button>
    <div class="m-accordion-body" id="adminForm">
        {% if form.errors %}
        <div class="alert alert-danger mb-3" style="border-radius:10px;font-size:.875rem;">
            <i class="fas fa-exclamation-triangle me-2"></i>
            {% for field in form %}{% for error in field.errors %}{{ error }} {% endfor %}{% endfor %}
            {% for error in form.non_field_errors %}{{ error }} {% endfor %}
        </div>
        {% endif %}

        <form method="post" action="{% url 'common:login' %}">
            {% csrf_token %}
            <input type="hidden" name="next" value="{{ next }}">

            <div class="m-form-group">
                <label class="m-form-label" for="username">사용자 이름</label>
                <input type="text" class="m-form-input" id="username" name="username"
                       value="{{ form.username.value|default_if_none:'' }}"
                       placeholder="사용자 이름 입력" autocomplete="username">
            </div>
            <div class="m-form-group">
                <label class="m-form-label" for="password">비밀번호</label>
                <input type="password" class="m-form-input" id="password" name="password"
                       placeholder="비밀번호 입력" autocomplete="current-password">
            </div>
            <button type="submit" class="m-btn-primary">
                <i class="fas fa-sign-in-alt me-2"></i>로그인
            </button>
            <div class="m-link-row" style="margin-top:14px;">
                <a href="{% url 'common:password_reset' %}"><i class="fas fa-key me-1"></i>비밀번호 찾기</a>
            </div>
        </form>
    </div>

    <!-- 회원가입 링크 -->
    <div class="m-link-row">
        아직 계정이 없으신가요? <a href="{% url 'common:signup' %}">회원가입</a>
    </div>
</div>
{% endblock %}

{% block script %}
<script>
document.getElementById('adminToggle').addEventListener('click', function() {
    var form = document.getElementById('adminForm');
    var chevron = document.getElementById('adminChevron');
    form.classList.toggle('open');
    chevron.style.transform = form.classList.contains('open') ? 'rotate(180deg)' : '';
});

// 에러가 있으면 자동으로 펼치기
{% if form.errors %}
document.getElementById('adminForm').classList.add('open');
document.getElementById('adminChevron').style.transform = 'rotate(180deg)';
{% endif %}
</script>
{% endblock %}
